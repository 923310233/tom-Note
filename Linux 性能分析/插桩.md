# CPU Profiling Tools on Linux

剖析研究

Profiling is an effective method to provide measurements for the performance of software applications.

通过分析，您可以获得有关应用程序组件的细粒度信息，例如调用函数的频率，例程执行的时间以及代码中不同位置花费的时间。有了这些信息，您就可以确定性能瓶颈和软件应用程序中实施不良的部分，并找到有效的方法来改进它们。



**检测 && 采样是性能分析的两类方法。**



## Instrumentation

Instrumentation method inserts special code at the beginning and end of each routine to record when the routine starts and ends. 

The profiling result shows the actual time taken by the routine on each call.

有两类插桩的工具： **source-code modifying** profilers and **binary profilers**. 

Source-code modifying profilers insert the instrumenting code in the **source code**, while the binary profilers insert instrumentation into an application’s **executable code** once it is loaded in memory.

The inserted instrumentation code (timer calls) take some time themselves. To reduce the impact of that, 在每次运行分析器开始时，都要测量由检测过程产生的开销，然后再从测量结果中减去该开销。 But the instrumenting process could still **significantly affect an application’s performance in some cases**, for example when the routine is very short and frequently called, 因为插入的检测会干扰例程在CPU中的执行方式。



## Sampling

Sampling profilers record the executed instruction when the operating system interrupts the CPU at regular intervals to execute process switches, and correlates the recorded execution points with the routines and source code during the linking process. 

**The profiling result shows the frequenc**y with which a routine and source line is executing during the application’s run.



采样分析器几乎不会给应用程序运行过程带来任何开销，并且它们在小型且通常被称为例程的程序上运行良好。缺点之一是所花费时间的评估是统计近似值，而不是实际时间。采样也只能告诉当前正在执行什么例程，而不是从何处调用它。



## 1. perf

`perf` is based on the perf_events system, which is based on event-based sampling

一句话来说，perf是基于采样的

The `perf record` command collects samples and generates an output file called `perf.data`. This file can then be analyzed using `perf report`









### strace && ltrace

在linux平台上，strace和ltrace是两款重要的调试分析工具，熟练使用这两个工具可以极大提高分析人员的工作效率，诊断软件的各种疑难杂症。其中，strace能够跟踪所有由用户进程空间发出的系统调用，ltrace则能够跟踪进程调用的库函数信息。





